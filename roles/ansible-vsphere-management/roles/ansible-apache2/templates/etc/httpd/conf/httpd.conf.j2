ServerRoot "/etc/httpd"

Listen {{ apache2_default_port }}
Include conf.modules.d/*.conf

User {{ apache2_web_owner }}
Group {{ apache2_web_group }}

ServerAdmin {{ apache2_server_admin }}

<Directory />
    AllowOverride none
    Require all denied
</Directory>

DocumentRoot "{{ apache2_web_root }}"

<Directory "/var/www">
    AllowOverride None
    Require all granted
</Directory>

<Directory "/var/www/html">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>

<Files ".ht*">
    Require all denied
</Files>

ErrorLog "logs/error_log"
LogLevel warn

<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    <IfModule logio_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>
    CustomLog "logs/access_log" combined
</IfModule>

<IfModule alias_module>
    ScriptAlias /cgi-bin/ "/var/www/cgi-bin/"
</IfModule>

<Directory "/var/www/cgi-bin">
    AllowOverride None
    Options None
    Require all granted
</Directory>

<IfModule mime_module>
    TypesConfig /etc/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
</IfModule>

AddDefaultCharset UTF-8

<IfModule mime_magic_module>
    MIMEMagicFile conf/magic
</IfModule>

{% if apache2_virtual_hosts is defined and apache2_config_virtual_hosts %}
{%   for item in apache2_virtual_hosts %}
<VirtualHost *:{{ item.port }}>
	ServerAdmin {{ item.serveradmin }}
	DocumentRoot {{ item.documentroot }}
{%     if not item.default_site %}
	ServerName {{ item.servername }}
{%     endif %}
{%     if not item.default_site %}
	ErrorLog {{ apache2_log_dir }}/{{ item.servername }}_error.log
	CustomLog {{ apache2_log_dir }}/{{ item.servername }}_access.log combined
{%     elif item.default_site %}
ErrorLog {{ apache2_log_dir }}/error.log
CustomLog {{ apache2_log_dir }}/access.log combined
{%     endif %}

</VirtualHost>
{%   endfor %}
{% endif %}

EnableSendfile on
IncludeOptional conf.d/*.conf
